name: deploy

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read # ì½”ë“œ ì½ê¸° ê¶Œí•œ
  pull-requests: write # ìë™ë¦¬ë·°ì–´ ì„¤ì •ì„ ìœ„í•œ ì“°ê¸° ê¶Œí•œ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # ì €ì¥ì†Œ ì½”ë“œ ë‹¤ìš´ë¡œë“œ
      - name: Checkout Code
        uses: actions/checkout@v5
      # pnpm ì„¤ì¹˜
      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10
      # node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: "22.x"
          cache: "pnpm" # ìºì‹±í•´ë†“ì€ íŒ¨í‚¤ì§€ ê´€ë¦¬ì
      # ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: Install dependencies
        run: pnpm install # ë½íŒŒì¼ì´ ì—†ì–´ë„ ì˜ì¡´ì„± ì„¤ì¹˜ ê°€ëŠ¥
      # í”„ë¡œì íŠ¸ ë¹Œë“œ
      - name: Build project
        id: build_step
        run: pnpm build
        continue-on-error: true

      # ë¹Œë“œ ê²°ê³¼
      - name: Output build result
        if: github.event_name == 'pull_request' && always()
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: build-result
          message: |
            ### ğŸš€ ë¹Œë“œ ê²°ê³¼
            ${{ steps.build_step.outcome == 'success' && 'âœ… **ë¹Œë“œ ì„±ê³µ**' || 'âŒ **ë¹Œë“œ ì‹¤íŒ¨**' }}

            <details>
              <summary>ë¡œê·¸ í™•ì¸í•˜ê¸°</summary>
              [Actions íƒ­ì—ì„œ ìì„¸íˆ ë³´ê¸°](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
            </details>

      - name: Check Build Status
        if: steps.build_step.outcome == 'failure'
        run: exit 1
  assign:
    runs-on: ubuntu-latest
    steps:
      - name: auto-assign-author-and-reviewer
        if: github.event_name == 'pull_request'&&github.event.action=='opened'
        uses: hkusu/review-assign-action@v1
        with:
          assignees: ${{github.actor}} # ë‹´ë‹¹ì ì„¤ì •
          # reviewers: a, b, c (ë¦¬ë·°ì–´ë¥¼ ìë™ ì„¤ì •í•©ë‹ˆë‹¤)
